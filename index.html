<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>My Words App</title>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f5f7fa;
  margin: 0;
  padding: 0;
}

header {
  text-align: center;
  padding: 16px;
  font-size: 22px;
  font-weight: bold;
}

.container {
  max-width: 480px;
  margin: auto;
  padding: 16px;
}

button {
  width: 60%;
  padding: 14px;
  margin: 10px auto;
  display: block;
  font-size: 16px;
  border-radius: 8px;
  border: none;
  background: #2563eb;
  color: white;
}

button.secondary {
  background: #64748b;
}

button.danger {
  background: #dc2626;
}

button:disabled {
  background: #94a3b8;
}

.card {
  background: white;
  border-radius: 10px;
  padding: 16px;
  margin-bottom: 16px;
}

.word {
  font-size: 32px;
  text-align: center;
  margin: 12px 0;
}

.translation {
  font-size: 22px;
  text-align: center;
  color: #2563eb;
  margin-top: 10px;
}

.top-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.option {
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  padding: 10px;
  margin: 8px 0;
  text-align: center;
}

.option.correct { background: #bbf7d0; }
.option.wrong { background: #fecaca; }

footer {
  text-align: center;
  font-size: 12px;
  color: #475569;
  margin: 20px 0;
}
</style>
</head>

<body>

<header>My Words App</header>

<div class="container" id="app"></div>

<footer>
This App was designed by Eli Anenburg and His AI friend
</footer>

<script>
/* ========= Storage ========= */
const DB_KEY = "my_words_db";
const PRACTICE_KEY = "practice_state";

function loadWords() {
  return JSON.parse(localStorage.getItem(DB_KEY) || "[]");
}
function saveWords(words) {
  localStorage.setItem(DB_KEY, JSON.stringify(words));
}

/* ========= State ========= */
let app = document.getElementById("app");
let words = loadWords();
let practiceQueue = [];
let practiceIndex = 0;
let showTranslation = false;
let showOptions = false;

/* ========= Screens ========= */

function mainMenu() {
  app.innerHTML = `
    <div class="card">
      <button onclick="addWordScreen()">Add Word</button>
      <button onclick="practiceSetup()">Practice Words</button>
      <button onclick="loadCSV()">Load List</button>
      <button onclick="exportCSV()">Export Words</button>
      <button class="danger" onclick="resetDatabase()">Reset Word Database</button>
      <p style="text-align:center;margin-top:12px">
        Number of words in database: <b>${words.filter(w=>!w.hidden).length}</b>
      </p>
    </div>
  `;
}

/* ========= Add Word ========= */
function addWordScreen() {
  app.innerHTML = `
    <div class="card">
      <input id="en" placeholder="English word" style="width:100%;padding:10px" />
      <input id="he" placeholder="Hebrew translation" style="width:100%;padding:10px;margin-top:8px" />
      <button onclick="saveWord()">Save</button>
      <button class="secondary" onclick="mainMenu()">Back</button>
    </div>
  `;
}

function saveWord() {
  const en = document.getElementById("en").value.trim();
  const he = document.getElementById("he").value.trim();
  if (!en || !he) return alert("Missing data");
  words.push({
    en, he,
    hidden:false,
    createdAt:Date.now(),
    wasShown:false
  });
  saveWords(words);
  mainMenu();
}

/* ========= Practice Setup ========= */
function practiceSetup() {
  app.innerHTML = `
    <div class="card">
      <h3>Select Practice Size</h3>
      <button onclick="startPractice(30)">30</button>
      <button onclick="startPractice(50)">50</button>
      <button onclick="startPractice(100)">100</button>
      <button onclick="startPractice(200)">200</button>
      <button onclick="startPractice('ALL')">All</button>
      <label>
        <input type="checkbox" id="resetFlag" /> Reset Practice
      </label>
      <button class="secondary" onclick="mainMenu()">Back</button>
    </div>
  `;
}

/* ========= Practice Logic ========= */
function startPractice(size) {
  const reset = document.getElementById("resetFlag").checked;
  if (reset) {
    words.forEach(w=>w.wasShown=false);
    saveWords(words);
  }

  let available = words.filter(w=>!w.hidden && !w.wasShown)
    .sort((a,b)=>b.createdAt-a.createdAt);

  if (available.length === 0) {
    alert("Practice Complete â€“ All words were covered");
    return mainMenu();
  }

  if (size !== 'ALL') available = available.slice(0, size);

  practiceQueue = available;
  practiceIndex = 0;
  showWord();
}

function showWord() {
  const w = practiceQueue[practiceIndex];
  showTranslation = false;
  showOptions = false;

  app.innerHTML = `
    <div class="card">
      <div class="top-row">
        <div>${practiceIndex+1}/${practiceQueue.length}</div>
        <button onclick="speak('${w.en}')">ðŸ”Š</button>
      </div>

      <div class="word">${w.en}</div>
      ${showTranslation ? `<div class="translation">${w.he}</div>` : ""}

      <button onclick="revealTranslation()">Show Translation</button>
      <button onclick="revealOptions()">Show Options</button>
      <button onclick="nextWord()">Next Word</button>

      <hr />
      <button class="secondary" onclick="editWord()">Edit Word</button>
      <button class="secondary" onclick="hideWord()">Hide</button>
      <button class="danger" onclick="deleteWord()">Delete</button>

      <button class="secondary" onclick="mainMenu()">Finish Practice</button>
    </div>
  `;
}

function revealTranslation() {
  showTranslation = true;
  showWord();
}

function revealOptions() {
  showOptions = true;
  const w = practiceQueue[practiceIndex];
  const options = shuffle([w.he, "××•×¤×¦×™×” ××§×¨××™×ª", "××•×¤×¦×™×” ×©×’×•×™×”", "×ª×¨×’×•× ××—×¨"]);
  let html = options.map(o=>`<div class="option">${o}</div>`).join("");
  app.querySelector(".card").insertAdjacentHTML("beforeend", html);
}

function nextWord() {
  practiceQueue[practiceIndex].wasShown = true;
  saveWords(words);
  practiceIndex++;
  if (practiceIndex >= practiceQueue.length) {
    alert("Practice Completed");
    return mainMenu();
  }
  showWord();
}

/* ========= Helpers ========= */
function shuffle(arr) {
  return arr.sort(()=>Math.random()-0.5);
}
function speak(t) {
  speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}
function deleteWord() {
  if (!confirm("Delete word?")) return;
  const w = practiceQueue[practiceIndex];
  words = words.filter(x=>x!==w);
  saveWords(words);
  mainMenu();
}
function hideWord() {
  practiceQueue[practiceIndex].hidden = true;
  saveWords(words);
  nextWord();
}
function editWord() {
  const w = practiceQueue[practiceIndex];
  app.innerHTML = `
    <div class="card">
      <input id="en" value="${w.en}" style="width:100%;padding:10px" />
      <input id="he" value="${w.he}" style="width:100%;padding:10px;margin-top:8px" />
      <button onclick="saveEdit()">Save</button>
    </div>
  `;
}
function saveEdit() {
  const w = practiceQueue[practiceIndex];
  w.en = document.getElementById("en").value;
  w.he = document.getElementById("he").value;
  saveWords(words);
  showWord();
}

/* ========= CSV ========= */
function exportCSV() {
  let csv = "English,Hebrew,Hidden,Created\n";
  words.forEach(w=>{
    csv += `"${w.en}","${w.he}",${w.hidden},${new Date(w.createdAt).toISOString()}\n`;
  });
  const blob = new Blob([csv],{type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = `words_${Date.now()}.csv`;
  a.click();
}
function loadCSV() {
  alert("CSV Load placeholder â€“ stable baseline");
}
function resetDatabase() {
  if (!confirm("Reset ALL words?")) return;
  localStorage.removeItem(DB_KEY);
  words=[];
  mainMenu();
}

/* ========= Init ========= */
mainMenu();
</script>

</body>
</html>
