<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Words App</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
button { margin: 5px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
#wordDisplay { font-size: 24px; margin-top: 20px; display: flex; align-items: center; justify-content: space-between; }
#progress { font-size: 14px; color: #555; }
.option-btn { background-color: #e0e0e0; margin: 5px 0; display: block; width: 100%; text-align: left; }
#translation { margin-top: 10px; font-size: 20px; color: #007700; }
#optionsContainer button { background-color: #ffe0b2; } /* ××•×¤×¦×™×•×ª ×¨×‘-×‘×¨×™×¨×” ×‘×¦×‘×¢ ××—×¨ */
footer { font-size: 12px; color: #777; text-align: center; margin-top: 30px; }
.overlay, .popup { display: none; position: fixed; top: 0; left:0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
.overlay-content, .popup-content { background: white; padding: 20px; border-radius: 10px; width: 90%; max-width: 400px; }
input { width: 100%; padding: 8px; margin: 5px 0; font-size: 16px; }
.close-btn { float: right; cursor: pointer; font-weight: bold; }
</style>
</head>
<body>

<h1>My Words App</h1>

<div id="mainMenu">
    <button id="addWordBtn">×”×•×¡×¤×ª ××™×œ×”</button>
    <button id="practiceBtn">×ª×¨×’×•×œ</button>
    <button id="loadCSVBtn">×˜×¢×™× ×ª ×¨×©×™××”</button>
    <button id="exportCSVBtn">×™×™×¦×•× ×¨×©×™××ª ××™×œ×™×</button>
</div>

<!-- ×”×•×¡×¤×ª ××™×œ×” -->
<div id="addWordSection" style="display:none;">
    <h2>×”×•×¡×¤×ª ××™×œ×”</h2>
    <label>English:</label>
    <input type="text" id="newWord">
    <button id="translateBtn">×ª×¨×’× online</button>
    <label>Hebrew:</label>
    <input type="text" id="newTranslation">
    <button id="saveWordBtn">×©××•×¨</button>
    <button onclick="showMainMenu()">×—×–×¨×”</button>
    <p id="addWordMsg"></p>
</div>

<!-- ×ª×¨×’×•×œ -->
<div id="practiceSection" style="display:none;">
    <div id="practiceOptions">
        <p>×‘×—×¨ ××¡×¤×¨ ××™×œ×™× ×œ×ª×¨×’×•×œ:</p>
        <button data-count="30">30 ××™×œ×™× ××—×¨×•× ×•×ª</button>
        <button data-count="50">50 ××™×œ×™× ××—×¨×•× ×•×ª</button>
        <button data-count="100">100 ××™×œ×™× ××—×¨×•× ×•×ª</button>
        <button data-count="200">200 ××™×œ×™× ××—×¨×•× ×•×ª</button>
        <button data-count="all">×›×œ ×”××™×œ×™×</button>
        <button onclick="showMainMenu()">×‘×™×˜×•×œ</button>
    </div>

    <div id="practiceWordArea" style="display:none;">
        <div id="wordDisplay">
            <span id="currentWord">Word</span>
            <span id="progress">0/0</span>
            <button id="speakBtn">ğŸ”Š</button>
        </div>
        <div id="translation"></div>
        <div id="practiceBtns">
            <button id="showTranslationBtn">×”×¦×’ ×ª×¨×’×•×</button>
            <button id="showOptionsBtn">×”×¦×’ ××¤×©×¨×•×™×•×ª</button>
            <button id="nextWordBtn">×œ××™×œ×” ×”×‘××”</button>
            <button id="hideWordBtn">×”×¡×ª×¨</button>
            <button id="editWordBtn">×¢×¨×•×š ××™×œ×”</button>
            <button id="deleteWordBtn">××—×§ ××™×œ×”</button>
        </div>
        <div id="optionsContainer"></div>
    </div>
</div>

<!-- Overlay ×œ×¢×¨×™×›×” -->
<div class="overlay" id="editOverlay">
    <div class="overlay-content">
        <span class="close-btn" onclick="closeEditOverlay()">Ã—</span>
        <h3>×¢×¨×™×›×ª ××™×œ×”</h3>
        <label>English:</label>
        <input type="text" id="editEnglish">
        <label>Hebrew:</label>
        <input type="text" id="editHebrew">
        <button onclick="saveEditWord()">×©××•×¨</button>
        <button onclick="closeEditOverlay()">×‘×™×˜×•×œ</button>
    </div>
</div>

<!-- Popup ×œ××—×™×§×” -->
<div class="popup" id="deletePopup">
    <div class="popup-content">
        <p>Are you sure you want to delete this word?</p>
        <button onclick="confirmDeleteWord()">Delete Word</button>
        <button onclick="closeDeletePopup()">Back</button>
    </div>
</div>

<input type="file" id="csvFileInput" style="display:none">

<footer>
This App was designed by Eli Anenburg and His AI friend
</footer>

<script>
const STORAGE_KEY = 'myWordsAppWords';
let words = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
let practiceList = [];
let currentIndex = 0;
let currentWordObj = null;
let correctCount = 0;

// --- Main Menu ---
document.getElementById('addWordBtn').onclick = () => showSection('addWordSection');
document.getElementById('practiceBtn').onclick = () => showSection('practiceSection');
document.getElementById('loadCSVBtn').onclick = () => document.getElementById('csvFileInput').click();
document.getElementById('exportCSVBtn').onclick = exportCSV;

// --- Show/Hide Sections ---
function showSection(sectionId) {
    document.getElementById('mainMenu').style.display = 'none';
    document.getElementById('addWordSection').style.display = 'none';
    document.getElementById('practiceSection').style.display = 'none';
    document.getElementById(sectionId).style.display = 'block';
}
function showMainMenu() { document.getElementById('mainMenu').style.display = 'block'; showSection(''); }

// --- Add Word ---
document.getElementById('translateBtn').onclick = async () => {
    const word = document.getElementById('newWord').value.trim();
    if(!word) { alert('Enter an English word'); return; }
    document.getElementById('newTranslation').value = word + "_he"; // Demo translation
}
document.getElementById('saveWordBtn').onclick = () => {
    const eng = document.getElementById('newWord').value.trim();
    const heb = document.getElementById('newTranslation').value.trim();
    if(!eng || !heb) { document.getElementById('addWordMsg').innerText = '×™×© ×œ×”×–×™×Ÿ ××ª ×›×œ ×”×©×“×•×ª'; return; }
    if(!words.some(w=>w.english===eng)){
        words.push({english:eng, hebrew:heb, isHidden:false, dateCreated: new Date().toISOString(), score:0});
        localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
        document.getElementById('addWordMsg').innerText = '× ×©××¨ ×‘×”×¦×œ×—×”!';
        document.getElementById('newWord').value=''; document.getElementById('newTranslation').value='';
    } else {
        document.getElementById('addWordMsg').innerText = '×”××™×œ×” ×›×‘×¨ ×§×™×™××ª';
    }
}

// --- Practice Selection ---
document.querySelectorAll('#practiceOptions button[data-count]').forEach(btn=>{
    btn.onclick = () => startPractice(btn.getAttribute('data-count'));
});
function startPractice(count) {
    const availableWords = words.filter(w=>!w.isHidden);
    if(availableWords.length===0){ alert('××™×Ÿ ××™×œ×™× ×–××™× ×•×ª ×œ×ª×¨×’×•×œ'); showMainMenu(); return; }
    let n;
    if(count==='all') n = availableWords.length;
    else n = Math.min(parseInt(count), availableWords.length);
    if(n<parseInt(count) && count!=='all') alert(`× ××¦××• ×¨×§ ${availableWords.length} ××™×œ×™× ×–××™× ×•×ª`);
    
    practiceList = [...availableWords].sort((a,b)=>a.score - b.score).slice(0,n);
    currentIndex = 0;
    correctCount = 0;
    showSection('practiceSection');
    document.getElementById('practiceOptions').style.display='none';
    document.getElementById('practiceWordArea').style.display='block';
    showNextWord();
}

// --- Show Word ---
function showNextWord() {
    if(currentIndex>=practiceList.length){ 
        alert(`×¡×™×•× ×”×ª×¨×’×•×œ! ×”×¦×œ×—×ª ×‘-${correctCount}/${practiceList.length} ××™×œ×™×.`);
        showMainMenu(); 
        return; 
    }
    currentWordObj = practiceList[currentIndex];
    document.getElementById('currentWord').innerText = currentWordObj.english;
    document.getElementById('translation').innerText = '';
    document.getElementById('progress').innerText = `${currentIndex+1}/${practiceList.length}`;
    document.getElementById('optionsContainer').innerHTML='';

    document.getElementById('showTranslationBtn').disabled=false;
    document.getElementById('showOptionsBtn').disabled=false;
    document.getElementById('nextWordBtn').disabled=false;
}

// --- Practice Buttons ---
document.getElementById('showTranslationBtn').onclick = () => {
    document.getElementById('translation').innerText = currentWordObj.hebrew;
    currentWordObj.score++; 
    localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
    correctCount++;
}

// --- Options Multiple Choice ---
document.getElementById('showOptionsBtn').onclick = () => {
    document.getElementById('showTranslationBtn').disabled=true;
    document.getElementById('nextWordBtn').disabled=true;
    document.getElementById('optionsContainer').innerHTML='';

    // ×‘×—×¨ ×©×œ×•×© ××¤×©×¨×•×™×•×ª × ×•×¡×¤×•×ª ××§×¨××™×•×ª + × ×›×•× ×”
    const options = [currentWordObj.hebrew];
    const otherWords = words.filter(w=>w.english!==currentWordObj.english);
    while(options.length<4 && otherWords.length>0){
        const idx = Math.floor(Math.random()*otherWords.length);
        const val = otherWords[idx].hebrew;
        if(!options.includes(val)) options.push(val);
    }
    shuffleArray(options);

    options.forEach(opt=>{
        const btn = document.createElement('button');
        btn.innerText = opt;
        btn.className = 'option-btn';
        btn.onclick = () => checkOption(opt);
        document.getElementById('optionsContainer').appendChild(btn);
    });
}

function checkOption(selected){
    const container = document.getElementById('optionsContainer');
    Array.from(container.children).forEach(b=>b.disabled=true);
    const translationDiv = document.getElementById('translation');
    if(selected === currentWordObj.hebrew){
        translationDiv.innerText = 'âœ… × ×›×•× ×”!';
        currentWordObj.score++;
        correctCount++;
    } else {
        translationDiv.innerText = `âŒ ×©×’×•×™×”! ×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${currentWordObj.hebrew}`;
    }
    document.getElementById('nextWordBtn').disabled=false;
}

// --- Next Word Button ---
document.getElementById('nextWordBtn').onclick = () => {
    currentIndex++; showNextWord();
}

// --- Hide Word ---
document.getElementById('hideWordBtn').onclick = () => { 
    currentWordObj.isHidden=true; 
    localStorage.setItem(STORAGE_KEY, JSON.stringify(words)); 
    currentIndex++; showNextWord(); 
}

// --- Edit & Delete ---
document.getElementById('editWordBtn').onclick = () => {
    document.getElementById('editEnglish').value = currentWordObj.english;
    document.getElementById('editHebrew').value = currentWordObj.hebrew;
    document.getElementById('editOverlay').style.display='flex';
}
function closeEditOverlay(){ document.getElementById('editOverlay').style.display='none'; }
function saveEditWord(){
    currentWordObj.english = document.getElementById('editEnglish').value.trim();
    currentWordObj.hebrew = document.getElementById('editHebrew').value.trim();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
    closeEditOverlay();
    showNextWord();
}

document.getElementById('deleteWordBtn').onclick = () => { document.getElementById('deletePopup').style.display='flex'; }
function closeDeletePopup(){ document.getElementById('deletePopup').style.display='none'; }
function confirmDeleteWord(){
    const idx = words.indexOf(currentWordObj);
    if(idx>-1){ words.splice(idx,1); localStorage.setItem(STORAGE_KEY, JSON.stringify(words)); }
    closeDeletePopup();
    if(currentIndex>=practiceList.length-1) showMainMenu();
    else showNextWord();
}

// --- Speak Word ---
document.getElementById('speakBtn').onclick = () => {
    const utter = new SpeechSynthesisUtterance(currentWordObj.english);
    speechSynthesis.speak(utter);
}

// --- Load CSV ---
document.getElementById('csvFileInput').addEventListener('change', function(e){
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(e){
        const lines = e.target.result.split('\n');
        lines.forEach(line=>{
            const [eng, heb]=line.trim().split(',');
            if(eng && heb && !words.some(w=>w.english===eng)){
                words.push({english:eng, hebrew:heb, isHidden:false, dateCreated: new Date().toISOString(), score:0});
            }
        });
        localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
        alert('×¨×©×™××ª ××™×œ×™× × ×˜×¢× ×” ×‘×”×¦×œ×—×”!');
    }
    reader.readAsText(file);
});

// --- Export CSV ---
function exportCSV(){
    if(words.length===0){ alert('××™×Ÿ ××™×œ×™× ×œ×™×™×¦×•×'); return; }
    const header = ['English','Hebrew','IsHidden','DateCreated','Score'];
    const csvRows = [header.join(',')];
    words.forEach(w=>{
        csvRows.push([w.english,w.hebrew,w.isHidden,w.dateCreated,w.score].join(','));
    });
    const csvContent = "data:text/csv;charset=utf-8," + csvRows.join('\n');
    const encodedUri = encodeURI(csvContent);
    const link = document.createElement("a");
    const dateStr = new Date().toISOString().split('T')[0];
    link.setAttribute("href", encodedUri);
    link.setAttribute("download", `MyWordsBackup_${dateStr}.csv`);
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// --- Helper ---
function shuffleArray(array){ for(let i=array.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [array[i],array[j]]=[array[j],array[i]]; } }
</script>

</body>
</html>
