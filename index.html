<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Word Practice App</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  margin: 0;
  padding: 0;
}
header {
  background: #2c3e50;
  color: white;
  padding: 16px;
  text-align: center;
}
main {
  padding: 20px;
}
button {
  padding: 12px 18px;
  margin: 6px;
  font-size: 16px;
  cursor: pointer;
}
.primary {
  background: #3498db;
  color: white;
  border: none;
}
.success {
  background: #2ecc71;
  color: white;
  border: none;
}
.danger {
  background: #e74c3c;
  color: white;
  border: none;
}
.secondary {
  background: #95a5a6;
  color: white;
  border: none;
}
.hidden {
  display: none;
}
.center {
  text-align: center;
}
.big-word {
  font-size: 36px;
  font-weight: bold;
}
.options button {
  display: block;
  width: 80%;
  margin: 8px auto;
}
.footer {
  text-align: center;
  font-size: 12px;
  color: #777;
  margin-top: 40px;
}
.checkbox {
  margin-top: 10px;
}
</style>
</head>

<body>
<header>
  <h1>Word Practice App</h1>
</header>

<main>

<!-- MAIN MENU -->
<div id="mainMenu" class="center">
  <button class="primary" style="width:60%" onclick="openPracticeSetup()">Practice Words</button><br>
  <button class="primary" style="width:60%" onclick="loadSample()">Load Sample List</button><br>
  <button class="danger" style="width:60%" onclick="resetDatabase()">Reset Word Database</button>
  <p id="wordCount"></p>
</div>

<!-- PRACTICE SETUP -->
<div id="practiceSetup" class="hidden center">
  <h2>Select Practice Size</h2>
  <button onclick="startPractice(30)">30</button>
  <button onclick="startPractice(50)">50</button>
  <button onclick="startPractice(100)">100</button>
  <button onclick="startPractice(200)">200</button>
  <button onclick="startPractice('ALL')">ALL</button>

  <div class="checkbox">
    <label>
      <input type="checkbox" id="resetPracticeCheckbox">
      Reset Practice
    </label>
  </div>

  <br>
  <button class="secondary" onclick="goHome()">Back</button>
</div>

<!-- PRACTICE SCREEN -->
<div id="practiceScreen" class="hidden center">
  <div id="progress"></div>
  <div class="big-word" id="englishWord"></div>

  <div id="translation" class="hidden"></div>

  <div id="confirmButtons" class="hidden">
    <button class="success" onclick="confirmKnown(true)">âœ” V</button>
    <button class="danger" onclick="confirmKnown(false)">âœ– X</button>
  </div>

  <div>
    <button id="showTranslationBtn" onclick="showTranslation()">Show Translation</button>
    <button id="showOptionsBtn" onclick="showOptions()">Show Options</button>
  </div>

  <div class="options hidden" id="options"></div>

  <button id="nextBtn" class="primary hidden" onclick="nextWord()">Next Word</button>
</div>

<!-- PRACTICE COMPLETE -->
<div id="practiceComplete" class="hidden center">
  <h2>Practice Completed âœ…</h2>
  <p id="practiceSummary"></p>
  <button class="primary" onclick="goHome()">Back to Main Menu</button>
</div>

<div class="footer">
  This App was designed by Eli Anenburg and His AI friend
</div>

</main>

<script>
const STORAGE_KEY = "wordsDB";
let words = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");

let practiceQueue = [];
let currentIndex = 0;
let currentWord = null;
let waitingForDecision = false;

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(words));
  updateWordCount();
}

function updateWordCount() {
  document.getElementById("wordCount").innerText =
    "Number of words in database: " + words.length;
}

updateWordCount();

/* ---------- DATABASE ---------- */
function resetDatabase() {
  if (!confirm("Are you sure you want to delete ALL words?")) return;
  words = [];
  save();
}

function loadSample() {
  const sample = [
    ["apple", "×ª×¤×•×—"],
    ["dog", "×›×œ×‘"],
    ["house", "×‘×™×ª"],
    ["sun", "×©×ž×©"],
    ["water", "×ž×™×"]
  ];
  sample.forEach(([e,t]) => {
    if (!words.find(w => w.english === e)) {
      words.push({
        english: e,
        translation: t,
        createdAt: Date.now(),
        isHidden: false,
        wasShownInCurrentCycle: false,
        wasCorrectInLastCycle: true,
        wasConfirmedKnown: false
      });
    }
  });
  save();
}

/* ---------- NAV ---------- */
function goHome() {
  hideAll();
  document.getElementById("mainMenu").classList.remove("hidden");
}

function openPracticeSetup() {
  hideAll();
  document.getElementById("practiceSetup").classList.remove("hidden");
}

function hideAll() {
  document.querySelectorAll("main > div").forEach(d => d.classList.add("hidden"));
}

/* ---------- PRACTICE LOGIC ---------- */
function startPractice(limit) {
  if (document.getElementById("resetPracticeCheckbox").checked) {
    words.forEach(w => {
      w.wasShownInCurrentCycle = false;
      w.wasConfirmedKnown = false;
    });
    save();
  }

  const candidates = words.filter(w => !w.isHidden && !w.wasConfirmedKnown);

  const incorrect = candidates.filter(w => w.wasCorrectInLastCycle === false);
  const lifo = candidates
    .filter(w => w.wasCorrectInLastCycle !== false)
    .sort((a,b) => b.createdAt - a.createdAt);

  practiceQueue = [...incorrect, ...lifo];
  if (limit !== "ALL") practiceQueue = practiceQueue.slice(0, limit);

  if (practiceQueue.length === 0) {
    alert("Congratulations! All words were covered ðŸŽ‰");
    goHome();
    return;
  }

  currentIndex = 0;
  hideAll();
  document.getElementById("practiceScreen").classList.remove("hidden");
  showCurrentWord();
}

function showCurrentWord() {
  currentWord = practiceQueue[currentIndex];
  document.getElementById("englishWord").innerText = currentWord.english;
  document.getElementById("translation").classList.add("hidden");
  document.getElementById("confirmButtons").classList.add("hidden");
  document.getElementById("options").classList.add("hidden");
  document.getElementById("nextBtn").classList.add("hidden");
  document.getElementById("showOptionsBtn").disabled = false;
  document.getElementById("showTranslationBtn").disabled = false;
  waitingForDecision = false;

  document.getElementById("progress").innerText =
    `${currentIndex+1} / ${practiceQueue.length}`;
}

function showTranslation() {
  document.getElementById("translation").innerText = currentWord.translation;
  document.getElementById("translation").classList.remove("hidden");
  document.getElementById("confirmButtons").classList.remove("hidden");
  document.getElementById("showOptionsBtn").disabled = true;
  waitingForDecision = true;
}

function showOptions() {
  document.getElementById("showOptionsBtn").disabled = true;
  document.getElementById("showTranslationBtn").disabled = true;

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  optionsDiv.classList.remove("hidden");

  const options = shuffle([
    currentWord.translation,
    ...shuffle(words.map(w => w.translation).filter(t => t !== currentWord.translation)).slice(0,3)
  ]);

  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.innerText = opt;
    btn.onclick = () => handleOption(opt, btn);
    optionsDiv.appendChild(btn);
  });
}

function handleOption(opt, btn) {
  if (waitingForDecision) return;
  waitingForDecision = true;

  const buttons = document.querySelectorAll("#options button");
  buttons.forEach(b => b.disabled = true);

  if (opt === currentWord.translation) {
    btn.classList.add("success");
    document.getElementById("confirmButtons").classList.remove("hidden");
  } else {
    btn.classList.add("danger");
    buttons.forEach(b => {
      if (b.innerText === currentWord.translation) {
        b.classList.add("success");
      }
    });
    currentWord.wasCorrectInLastCycle = false;
    document.getElementById("nextBtn").classList.remove("hidden");
  }
}

function confirmKnown(known) {
  currentWord.wasCorrectInLastCycle = known;
  currentWord.wasConfirmedKnown = known;
  document.getElementById("nextBtn").classList.remove("hidden");
}

function nextWord() {
  currentWord.wasShownInCurrentCycle = true;
  save();
  currentIndex++;
  if (currentIndex >= practiceQueue.length) {
    hideAll();
    document.getElementById("practiceComplete").classList.remove("hidden");
    document.getElementById("practiceSummary").innerText =
      `You practiced ${practiceQueue.length} words.`;
  } else {
    showCurrentWord();
  }
}

/* ---------- UTILS ---------- */
function shuffle(arr) {
  return arr.sort(() => Math.random() - 0.5);
}
</script>
</body>
</html>
